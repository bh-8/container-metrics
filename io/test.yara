import "console"
import "cm"

/// [
///     [[0],[0]],
///     [[2068],[2353]],
///     [[1045],[1006]],
///     [[914],[1058]],
///     [[869],[1019]],
///     [[930],[1105]],
///     [[904],[1070]],
///     [[914],[1120]],
///     [[910],[1137]],
///     [[868],[1147]],
///     [[859],[1236]],
///     [[830],[1273]],
///     [[877],[1277]],
///     [[931],[1235]],
///     [[859],[1266]],
///     [[877],[1274]]
/// ]

/// [
///     [[644,698],[638,608]],
///     [[594,605],[615,579]],
///     [[597,627],[605,609]]
/// ]

/// [
///     [[50,93],[23,29]],
///     [[-3,-22],[10,-30]],
/// ]

/// [[[0],[0]],[[2068],[2353]],[[1045],[1006]],[[914],[1058]],[[869],[1019]],[[930],[1105]],[[904],[1070]],[[914],[1120]],[[910],[1137]],[[868],[1147]],[[859],[1236]],[[830],[1273]],[[877],[1277]],[[931],[1235]],[[859],[1266]],[[877],[1274]]]
/// map(&map(&zip(@[0], @[1]) | map(&[1] - &[0])), zip(@[0:-1], @[1:]))
/// sections[?mime_type=='audio/mpeg'].segments.mpeg_frames[].[side_info.granule_info[0].part2_3_length,side_info.granule_info[1].part2_3_length]

/// sections[?mime_type=='audio/mpeg'].segments.mpeg_frames[].[side_info.granule_info[0].part2_3_length,side_info.granule_info[1].part2_3_length] | map(zip(@[0:-1], @[1:]) | map(&map(zip(@[0], @[1]) | map(&[1] - &[0]))))

rule example_rule : main {
    condition:
        console.log("test.yara: ", cm.jmesq_s(mdb_url, mdb_pjt, mdb_set, mdb_oid, "sections[?mime_type=='audio/mpeg'].segments.mpeg_frames[].[side_info.granule_info[0].part2_3_length,side_info.granule_info[1].part2_3_length] | map(zip(@[0:-1], @[1:]))"))
}

/// [[[644,698],[638,608]],[[594,605],[615,579]],[[597,627],[605,609]],[[624,626],[606,597]],[[812,721],[698,681]],[[721,676],[746,637]],[[678,723],[722,742]],[[939,437],[1059,370]],[[862,622],[756,653]],[[750,739],[784,759]],[[782,721],[810,686]],[[824,754],[794,717]],[[839,733],[784,726]],[[751,774],[783,704]],[
/// [[644,698],[638,608],[594,605],[615,579],[597,627]
